# XRAI File Format Example: Virtual Cityscape

## Overview
This example demonstrates the **XRAI** (eXtended Reality AI) file format, an OpenUSD extension, for a real-time, AI-driven virtual cityscape. The format, renamed from AXR, emphasizes AI and XR integration. Insights from the following sources enhance the example:
- **Rerun.io Examples**: Efficient streaming of spatial data for real-time visualization.
- **OpenUSD Documentation**: Advanced USD features like asset references, variants, and Hydra rendering.
- **Unity AssetBundleManifest**: Asset bundling for optimized loading and updates.

The scene includes:
- **AI-Generated Terrain**: Cyberpunk cityscape using Gaussian Splats, with asset references.
- **Procedural Weather**: Dynamic rain with variants (light, heavy) using cellular automata.
- **Spatial Audio**: HRTF-based city sounds, bundled as an asset.
- **Streaming Data**: Real-time traffic flow visualization via a `StreamingPrim`.
- **Real-Time Optimizations**: LOD, culling, and adaptive rendering for cross-platform performance.
- **Camera Awareness**: View-dependent rendering based on the active camera.

The file is in USDA (ASCII) format with the `.xrai` extension, editable and compatible with OpenUSD tools.

## XRAI File Content
Below is the `Cityscape.xrai` file. Copy this content into a text editor and save as `Cityscape.xrai`.

```usda
#usda 1.0
(
    defaultPrim = "Cityscape"
    upAxis = "Y"
    metersPerUnit = 1.0
    customLayerData = {
        string formatVersion = "1.0",
        string description = "XRAI virtual cityscape with AI, streaming, and asset bundling"
    }
)

# Asset bundle manifest (inspired by Unity AssetBundleManifest)
def "AssetBundle" (
    kind = "manifest"
)
{
    string[] assets = [
        "assets/city_reference.jpg",
        "assets/city_ambience.wav",
        "assets/terrain_material.usd"
    ]
    string[] dependencies = []
    int bundleVersion = 1
    bool incrementalUpdate = true
}

def Xform "Cityscape" (
    kind = "scene"
)
{
    # Define the main camera
    def Camera "MainCamera" (
        kind = "camera"
    )
    {
        float focalLength = 50.0
        float2 clippingRange = (0.1, 1000.0)
        float3 xformOp:translate = (0, 10, 50)
        uniform token[] xformOpOrder = ["xformOp:translate"]
    }

    # AI-generated cityscape terrain using Gaussian Splats
    def AIProceduralPrim "CityTerrain" (
        kind = "model",
        aiModel = "GSplatGenerator",
        prompt = "A futuristic cyberpunk cityscape at night with neon lights",
        seed = 42,
        parameters = {
            "resolution": 2048,
            "style": "cyberpunk",
            "density": 0.8,
            "maxPoints": 1000000
        },
        inputs = [@assets/city_reference.jpg@],
        outputs = ["geometry", "material"],
        assetRef = @assets/terrain_material.usd@,
        lod = 1,
        renderPriority = 5,
        culling = true,
        adaptiveRendering = true,
        cameraView = </Cityscape/MainCamera>
    )
    {
        # Placeholder for generated geometry
        def Mesh "TerrainMesh" (
            kind = "mesh"
        )
        {
            # Geometry and material data generated by AI model
        }
    }

    # Procedural weather with variants
    def ProceduralPrim "WeatherEffect" (
        kind = "effect",
        variants = {
            string weatherType = "LightRain"
        }
    )
    {
        variantSets = "weatherType"
        {
            variant "LightRain" (
                algorithm = "cellular_automata",
                parameters = {
                    "iterations": 10,
                    "particleCount": 5000,
                    "fallSpeed": 3.0,
                    "windDirection": (0.5, 0.0, 0.0)
                },
                lod = 2,
                renderPriority = 10,
                culling = true,
                adaptiveRendering = true,
                userPreferences = {
                    "intensity": "light"
                }
            )
            {
                def ParticleSystem "RainParticles" (
                    kind = "particles"
                )
                {
                    # Particle data for light rain
                }
            }
            variant "HeavyRain" (
                algorithm = "cellular_automata",
                parameters = {
                    "iterations": 15,
                    "particleCount": 15000,
                    "fallSpeed": 6.0,
                    "windDirection": (1.0, 0.0, 0.0)
                },
                lod = 2,
                renderPriority = 10,
                culling = true,
                adaptiveRendering = true,
                userPreferences = {
                    "intensity": "heavy"
                }
            )
            {
                def ParticleSystem "RainParticles" (
                    kind = "particles"
                )
                {
                    # Particle data for heavy rain
                }
            }
        }
    }

    # Spatial audio for ambient city sounds
    def Sound "CityAmbience" (
        kind = "audio",
        spatializationMode = "HRTF",
        attenuationModel = "exponential",
        filePath = @assets/city_ambience.wav@,
        gain = 0.8,
        position = (0, 5, 0)
    )
    {
    }

    # Streaming traffic data visualization (inspired by Rerun.io)
    def StreamingPrim "TrafficFlow" (
        kind = "data",
        streamSource = "ws://traffic-api.example.com/stream",
        dataType = "point_cloud",
        parameters = {
            "updateFrequency": 0.1,
            "maxPoints": 5000,
            "colorMode": "velocity"
        },
        lod = 3,
        renderPriority = 8,
        culling = true,
        adaptiveRendering = true
    )
    {
        def PointCloud "TrafficPoints" (
            kind = "point_cloud"
        )
        {
            # Streaming point cloud data for traffic
        }
    }

    # Volumetric fog for atmosphere
    def Volume "CityFog" (
        kind = "volume",
        lod = 2,
        compression = "JPEG2000",
        density = 0.1,
        color = (0.5, 0.5, 0.6)
    )
    {
        # Volumetric data for fog
    }

    # Real-time rendering settings
    def RenderSettings "SceneRenderSettings" (
        kind = "render"
    )
    {
        float frameRate = 60.0
        int2 maxResolution = (1920, 1080)
        bool enableHydra = true
    }
}
```

## Explanation of Key Components

### Scene Structure
- **Root Prim**: The `Cityscape` Xform prim is the scene root, marked with `kind = "scene"`.
- **Metadata**: `customLayerData` includes version and description for XRAI format clarity.
- **Camera**: `MainCamera` defines the viewer’s perspective, positioned at (0, 10, 50).

### Asset Bundle Manifest
- **Prim**: `AssetBundle` mimics Unity’s AssetBundleManifest, listing assets (`city_reference.jpg`, `city_ambience.wav`, `terrain_material.usd`) and supporting incremental updates.
- **Attributes**:
  - `assets`: Array of file paths.
  - `dependencies`: Empty for simplicity (can include dependent bundles).
  - `bundleVersion`: Tracks updates.
  - `incrementalUpdate`: Enables partial loading.

### AI-Generated Terrain
- **Prim**: `CityTerrain` is an `AIProceduralPrim` using a GSplat generator.
- **Attributes**:
  - `aiModel = "GSplatGenerator"`: Specifies Gaussian Splats.
  - `prompt`: Describes the cyberpunk cityscape.
  - `inputs`: References a source image via asset bundle.
  - `assetRef`: Links to a USD material file for modularity.
  - `parameters`: Includes `maxPoints` for GSplat efficiency.
  - Real-time optimizations: `lod`, `renderPriority`, `culling`, `adaptiveRendering`.
  - `cameraView`: Links to `MainCamera` for view-dependent rendering.

### Procedural Weather with Variants
- **Prim**: `WeatherEffect` is a `ProceduralPrim` with variants for light and heavy rain, inspired by USD’s variant system.
- **Variants**:
  - `LightRain`: 5000 particles, slower fall speed.
  - `HeavyRain`: 15000 particles, faster fall speed.
- **Attributes**:
  - `algorithm = "cellular_automata"`: Procedural method.
  - `parameters`: Configures particle count, speed, and wind.
  - `userPreferences`: User-controlled intensity.
  - Real-time optimizations: Similar to `CityTerrain`.

### Spatial Audio
- **Prim**: `CityAmbience` is a `Sound` prim for ambient city sounds.
- **Attributes**:
  - `spatializationMode = "HRTF"`: Immersive audio.
  - `attenuationModel = "exponential"`: Distance-based fading.
  - `filePath`: References audio via asset bundle.

### Streaming Traffic Data
- **Prim**: `TrafficFlow` is a `StreamingPrim`, inspired by Rerun.io’s real-time data visualization.
- **Attributes**:
  - `streamSource`: WebSocket URL for traffic data (placeholder).
  - `dataType = "point_cloud"`: Visualizes traffic as points.
  - `parameters`: Sets update frequency and color based on velocity.
  - Real-time optimizations: `lod`, `renderPriority`, `culling`, `adaptiveRendering`.

### Volumetric Fog
- **Prim**: `CityFog` is a `Volume` prim for atmospheric fog.
- **Attributes**:
  - `lod = 2`: Reduces detail.
  - `compression = "JPEG2000"`: Efficient storage.
  -